/*
 *  Uzebox video mode 72 simple demo
 *  Copyright (C) 2017 Sandor Zsuga (Jubatian)
 *
 *  This program is free software: you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation, either version 3 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/

#include <stdbool.h>
#include <avr/io.h>
#include <stdlib.h>
#include <avr/pgmspace.h>
#include <uzebox.h>



static const unsigned char sprdata[] PROGMEM = {

 0b00000011U, 0b11111111U,
 0b00001111U, 0b01010111U,
 0b00111101U, 0b01010111U,
 0b11110101U, 0b01010111U,
 0b11110101U, 0b01010111U,
 0b00111101U, 0b01010111U,
 0b00001111U, 0b01010111U,
 0b00000011U, 0b11111111U,

 0b00000011U, 0b11111111U,
 0b00001111U, 0b01010111U,
 0b00111101U, 0b10100111U,
 0b11110110U, 0b10100111U,
 0b11110110U, 0b10100111U,
 0b00111101U, 0b10100111U,
 0b00001111U, 0b01010111U,
 0b00000011U, 0b11111111U,

 0b11111111U, 0b11111111U,
 0b11001111U, 0b01010111U,
 0b11111101U, 0b10100111U,
 0b11110110U, 0b10100111U,
 0b11110110U, 0b10100111U,
 0b11111101U, 0b10100111U,
 0b11001111U, 0b01010111U,
 0b11111111U, 0b11111111U,

 0b00000011U, 0b11001111U,
 0b00001111U, 0b00111111U,
 0b00111100U, 0b11110111U,
 0b11110011U, 0b11010111U,
 0b11110011U, 0b11010111U,
 0b00111100U, 0b11110111U,
 0b00001111U, 0b00111111U,
 0b00000011U, 0b11001111U,

};



static const unsigned char bgdata[] PROGMEM = {
 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,
 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,
 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,
 0x00U, 0x11U, 0x12U, 0x13U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,
 0x00U, 0x14U, 0x15U, 0x16U, 0x17U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,
 0x00U, 0x18U, 0x19U, 0x1AU, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,
 0x00U, 0x00U, 0x1BU, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,
 0x01U, 0x02U, 0x03U, 0x05U, 0x06U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U,

 0x09U, 0x0AU, 0x0AU, 0x0AU, 0x0BU, 0x05U, 0x06U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x11U, 0x12U, 0x13U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x08U, 0x01U, 0x02U,
 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0BU, 0x04U, 0x05U, 0x06U, 0x08U, 0x07U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x14U, 0x15U, 0x16U, 0x17U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x00U, 0x01U, 0x02U, 0x04U, 0x03U, 0x09U,
 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0AU, 0x0BU, 0x03U, 0x04U, 0x04U, 0x05U, 0x06U, 0x07U, 0x08U, 0x07U, 0x07U, 0x0EU, 0x0FU, 0x10U, 0x07U, 0x08U, 0x07U, 0x07U, 0x08U, 0x01U, 0x02U, 0x03U, 0x04U, 0x09U, 0x0AU, 0x0DU,
 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0AU, 0x0BU, 0x03U, 0x03U, 0x04U, 0x04U, 0x03U, 0x09U, 0x0AU, 0x0BU, 0x03U, 0x04U, 0x04U, 0x03U, 0x03U, 0x04U, 0x04U, 0x04U, 0x03U, 0x09U, 0x0AU, 0x0CU, 0x0CU, 0x0CU,
 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0AU, 0x0AU, 0x0AU, 0x0AU, 0x0AU, 0x0DU, 0x0CU, 0x0CU, 0x0BU, 0x03U, 0x03U, 0x09U, 0x0AU, 0x0AU, 0x0AU, 0x0AU, 0x0AU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,

 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,

 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0DU, 0x0CU, 0x0DU, 0x0CU, 0x0CU, 0x0CU,
};



/* " C-64 FONT " in PETSCII */
static const unsigned char txt_data[] PROGMEM = {
 0x20U, 0x03U, 0x2DU, 0x36U, 0x34U, 0x20U, 0x06U, 0x0FU, 0x0EU, 0x14U, 0x20U
};



int main(){

	unsigned char i;
	unsigned char j;
	unsigned char ct;
	unsigned int  yp[18];
	unsigned int  xp[18];

	/* Fill sprites */

	i = 0U;
	do{
		((unsigned char*)(0x0900U))[i] = i;
		((unsigned char*)(0x0E00U))[i] = pgm_read_byte(&(sprdata[i]));
		((unsigned char*)(0x0A00U))[i] = pgm_read_byte(&(bgdata[(unsigned int)(0x000U) + i]));
		((unsigned char*)(0x0B00U))[i] = pgm_read_byte(&(bgdata[(unsigned int)(0x100U) + i]));
		((unsigned char*)(0x0C00U))[i] = pgm_read_byte(&(bgdata[(unsigned int)(0x200U) + i]));
		((unsigned char*)(0x0D00U))[i] = pgm_read_byte(&(bgdata[(unsigned int)(0x300U) + i]));
		i ++;
	}while (i != 0U);

	/* VRAM start offsets */

	for (i = 0U; i < 32U; i++){

		m72_rowoff[i] = 0xA00U + ((unsigned int)(i) * 32U);

	}

	/* Text mode VRAM contents */

	for (i = 0U; i < sizeof(txt_data); i++){
		((unsigned char*)(0x0900U))[i] = pgm_read_byte(&(txt_data[i]));
	}

	/* Configure mode */

	m72_tt_hgt = 0U;
	m72_tb_hgt = 0U;
	m72_tt_trows = 2U;
	m72_tb_trows = 2U;
	m72_tt_vram = (unsigned char*)(0x900U);
	m72_tb_vram = (unsigned char*)(0x928U);
	bordercolor = 0x52U;

	m72_config = 0x04U; /* Sprite mode 0 */

	/* Set up sprites */

	for (i = 0U; i < 18U; i++){

		if ((i & 1U) == 0U){
			yp[i] = ( 32U + ((i >> 1) * 1U)) << 8;
		}else{
			yp[i] = (104U + ((i >> 1) * 1U)) << 8;
		}
		xp[i] = (40U + ((i >> 1) * 13U)) << 8;

		sprites[i].xpos   = 40U + (i * 5U);
		sprites[i].ypos   = yp[i] >> 8;
		sprites[i].off    = (i & 0x3U) * 16U;
		sprites[i].bank   = 0xEU;
		sprites[i].height = 8U | ((i & 4U) << 5);
		sprites[i].col1   = 0x13U;
		sprites[i].col2   = 0x47U;
		sprites[i].col3   = 0x7FU;

	}

	sprites[ 4].height |= 0x10U;
	sprites[ 5].height |= 0x10U;
	sprites[ 8].height  = 0x20U;
	sprites[ 9].height  = 0x18U;
	sprites[10].height  = 0x10U;
	sprites[12].height |= 0x10U;
	sprites[13].height |= 0x10U;
	sprites[16].height  = 0x20U;
	sprites[17].height  = 0x18U;

	/* Main loop */

	ct = 0U;

	while(1){

		/* Bg. scrolling */

		if ((ct & 0x80U) == 0U){
			j = (ct >> 1);
			for (i = 0U; i < 32U; i++){
				m72_rowoff[i] = (0xA00U + ((unsigned int)(i) * 32U)) + (j >> 3) + ((unsigned int)(j & 7U) << 12);
			}
		}else{
			j = 0x80U - (ct >> 1);
			for (i = 0U; i < 32U; i++){
				m72_rowoff[i] = (0xA00U + ((unsigned int)(i) * 32U)) + (j >> 3) + ((unsigned int)(j & 7U) << 12);
			}
		}

		/* Top / bottom text areas */

		if       (ct <  20U){
			m72_tt_hgt = ct;
			m72_tb_hgt = ct;
		}else if (ct < 120U){
			m72_tt_hgt = 20U;
			m72_tb_hgt = 20U;
		}else if (ct < 140U){
			m72_tt_hgt = 140U - ct;
			m72_tb_hgt = 140U - ct;
		}else{
			m72_tt_hgt = 0U;
			m72_tb_hgt = 0U;
		}

		/* Sprite movements */

		yp[ 0] += ct & 0x01U;
		yp[ 1] += ct & 0x02U;
		yp[ 2] += ct & 0x04U;
		yp[ 3] += ct & 0x08U;
		yp[ 4] += ct & 0x10U;
		yp[ 5] += ct & 0x20U;
		yp[ 6] += ct & 0x40U;
		yp[ 7] += ct & 0x80U;
		yp[ 8] += ct & 0x81U;
		yp[ 9] += ct & 0x82U;
		yp[10] += ct & 0x84U;
		yp[11] += ct & 0x88U;
		yp[12] += ct & 0x18U;
		yp[13] += ct & 0x28U;
		yp[14] += ct & 0x48U;
		yp[15] += ct & 0x88U;
		yp[16] += ct & 0x03U;
		yp[17] += ct & 0x05U;

		xp[ 0] += ct & 0x11U;
		xp[ 1] += ct & 0x12U;
		xp[ 2] += ct & 0x14U;
		xp[ 3] += ct & 0x18U;
		xp[ 4] += ct & 0x11U;
		xp[ 5] += ct & 0x21U;
		xp[ 6] += ct & 0x41U;
		xp[ 7] += ct & 0x81U;
		xp[ 8] += ct & 0x21U;
		xp[ 9] += ct & 0x22U;
		xp[10] += ct & 0x24U;
		xp[11] += ct & 0x28U;
		xp[12] += ct & 0x12U;
		xp[13] += ct & 0x22U;
		xp[14] += ct & 0x42U;
		xp[15] += ct & 0x82U;
		xp[16] += ct & 0x06U;
		xp[17] += ct & 0x09U;

		ct ++;

		for (i = 0U; i < 18U; i++){
			sprites[i].ypos = yp[i] >> 8;
			sprites[i].xpos = xp[i] >> 8;
		}

		WaitVsync(1);

	}

}
